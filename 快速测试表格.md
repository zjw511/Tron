# 快速测试表格显示

## 🧪 测试步骤（5分钟）

### 1. 重启服务器
```bash
# 停止当前服务器（Ctrl+C）
# 重新启动
python full_server.py
```

### 2. 刷新浏览器
```
Ctrl + Shift + R  （强制刷新）
```

### 3. 检查扩展加载
**按F12，查看Console**，应该看到：
```
[TablePreview] Loading table preview extension...
[TablePreview] ComfyUI loaded, registering extension...
[TablePreview] WebSocket monitoring active
```

### 4. 创建工作流
```
LoadCSV → PreviewTable
```

**LoadCSV配置**：
- file_path: `examples/sample_data.csv`

### 5. 执行并观察

点击 **Queue Prompt**

#### 后端日志（服务器控制台）：
```
[*] Executing node 1: LoadCSV
    [OK] Loaded CSV: 10 rows × 5 cols
[*] Executing node 2: PreviewTable
    [OK] Preview table: 10 rows × 5 cols
[OK] Node 2 executed successfully
[>>] Sending WebSocket message for node 2
```

#### 前端日志（浏览器F12）：
```
[TablePreview] WS message type: executed
[TablePreview] Execution message: {...}
[TablePreview] Output data: {...}
[TablePreview] ✓ Found table data: [...]
[TablePreview] Rendering table in node: 2
[TablePreview] Creating new container with ID: table-preview-2
[TablePreview] Container appended to body
[TablePreview] Setting innerHTML...
[TablePreview] ✓ Table rendered successfully!
```

#### 视觉效果：
**在浏览器右下角**应该出现一个黑色背景的表格面板！

### 6. 如果看不到表格

#### 检查1：查看浏览器控制台
是否有错误？最后一条日志是什么？

#### 检查2：手动查找元素
在浏览器Console运行：
```javascript
// 查找表格容器
const container = document.getElementById('table-preview-2');
console.log('Container found:', container);
console.log('Container visible:', container?.offsetHeight > 0);
console.log('Container style:', container?.style.cssText);
```

#### 检查3：手动创建测试表格
在浏览器Console运行：
```javascript
// 手动创建测试表格
const testDiv = document.createElement('div');
testDiv.style.cssText = 'position:fixed;bottom:10px;right:10px;background:#1e1e1e;border:2px solid #444;padding:20px;z-index:10000;color:#fff;';
testDiv.innerHTML = '<h3>测试表格</h3><p>如果你能看到这个，说明CSS定位正常</p>';
document.body.appendChild(testDiv);
```

**如果能看到测试表格**，说明问题在数据处理。
**如果看不到**，说明浏览器窗口问题（太小？被其他元素遮挡？）

#### 检查4：查看所有fixed元素
```javascript
// 查找所有fixed定位的元素
const fixedElements = Array.from(document.querySelectorAll('*')).filter(el => {
    return window.getComputedStyle(el).position === 'fixed';
});
console.log('Fixed elements:', fixedElements.length);
fixedElements.forEach((el, i) => {
    console.log(`${i}:`, el.className, el.getBoundingClientRect());
});
```

### 7. 预期效果

✅ **成功的样子**：
- 右下角出现黑色面板
- 显示表格标题 "Data Table"
- 显示行列信息 "10 rows × 5 columns"
- 显示表格数据（前20行）
- 有"关闭"按钮
- 有"显示全部"按钮（如果超过20行）
- 有"在弹窗中查看"链接

### 8. 交互测试

- ✅ 点击"关闭"按钮 → 面板消失
- ✅ 重新执行工作流 → 面板重新出现
- ✅ 点击"显示全部" → 显示所有行
- ✅ 点击"在弹窗中查看" → 打开全屏弹窗
- ✅ 可以滚动查看数据

## 🐛 常见问题

### Q: 完全看不到任何东西

**可能原因**：
1. 浏览器窗口太小，右下角被遮挡
2. 其他元素的z-index更高
3. CSS被其他样式覆盖

**解决**：
1. 全屏浏览器窗口
2. 查看F12控制台是否有CSS冲突错误
3. 手动运行检查3的测试代码

### Q: 看到"✓ Table rendered"但没有表格

**可能原因**：
- container.innerHTML设置失败
- 表格HTML生成错误

**调试**：
```javascript
const container = document.getElementById('table-preview-2');
console.log('HTML length:', container?.innerHTML.length);
console.log('HTML preview:', container?.innerHTML.substring(0, 200));
```

### Q: 数据没有传到前端

**症状**：看不到"✓ Found table data"

**检查后端**：
- PreviewTable节点是否正确执行？
- 是否显示"Sending WebSocket message"？

### Q: WebSocket没有连接

**症状**：只有加载日志，没有WS消息

**解决**：
1. 检查Network → WS标签
2. 应该有ws://127.0.0.1:8188/ws连接
3. 重启服务器和浏览器

## ✅ 成功标志

当一切正常时：
1. ✅ 后端显示"Sending WebSocket message"
2. ✅ 前端显示"✓ Found table data"
3. ✅ 前端显示"✓ Table rendered successfully"
4. ✅ **右下角出现黑色表格面板**
5. ✅ 数据正确显示

## 📸 预期效果图

```
┌─────────────────────────────────────┐
│  ComfyUI 界面                        │
│  [工作流画布]                         │
│                                     │
│                                     │
│                  ┌──────────────────┐│
│                  │ Data Table       ││
│                  │ 10 rows × 5 cols ││
│                  │                  ││
│                  │ [表格数据]        ││
│                  │ [关闭] [显示全部] ││
│                  └──────────────────┘│
└─────────────────────────────────────┘
            ↑
      在这里显示
```

---

**如果还是不显示，请把浏览器Console的完整日志发给我！**

