# 表格显示方式 - 重大更新

## ✅ 现在的工作方式

**PreviewTable节点现在会像PreviewImage一样工作！**

### 显示方式

```
┌──────────────────────┐
│   LoadCSV Node       │
│                      │
└──────┬───────────────┘
       │
       ▼
┌──────────────────────┐
│  PreviewTable Node   │
│  ┌────────────────┐  │
│  │  Data Table    │  │
│  │  10 rows × 5   │  │
│  │                │  │
│  │ [表格图片]      │  │
│  │  自动显示在    │  │
│  │  节点上        │  │
│  └────────────────┘  │
└──────────────────────┘
```

### 工作流程

1. LoadCSV加载数据
2. PreviewTable接收数据
3. **生成表格图片**（使用matplotlib）
4. **图片显示在PreviewTable节点上**
5. 就像PreviewImage显示图片一样！

## 🎨 表格样式

- **暗色主题**：背景 #1e1e1e
- **彩色表头**：深灰色 #2a2a2a
- **交替行色**：提高可读性
- **清晰边框**：#444颜色
- **显示行数**：前20行（自动）
- **分辨率**：100 DPI，清晰易读

## 📊 功能特性

### ✅ 优点

1. **附着在节点**：不需要到处找表格，就在节点上
2. **像图片一样**：和PreviewImage完全一致的体验
3. **自动显示**：执行后立即在节点上看到
4. **可保存**：图片保存在`temp/`目录
5. **可复制**：右键可以复制/保存图片
6. **简单直观**：不需要额外的弹窗或面板

### 📏 显示限制

- **默认显示**：前20行
- **为什么**：保持图片大小合理，节点不会太大
- **完整数据**：标题会显示总行数

### 📂 文件位置

表格图片保存在：
```
temp/table_{node_id}_{uuid}.png
```

例如：
```
temp/table_2_a1b2c3d4.png
```

## 🚀 使用方法

### 1. 创建工作流

```
LoadCSV → PreviewTable
```

### 2. 配置LoadCSV

```python
file_path = "examples/sample_data.csv"
```

### 3. 配置PreviewTable（可选）

```python
max_rows = 100      # 限制处理的最大行数
title = "我的数据"   # 表格标题
```

### 4. 运行

点击 **Queue Prompt**

### 5. 查看结果

**表格图片会直接显示在PreviewTable节点上！**

## 🔧 技术细节

### 后端实现

```python
# 使用matplotlib生成表格图片
import matplotlib.pyplot as plt

# 创建表格
fig, ax = plt.subplots()
table = ax.table(cellText=data, ...)

# 保存为图片
plt.savefig('temp/table.png')

# 返回图片信息（像PreviewImage）
return {
    "ui": {
        "images": [{
            "filename": "table.png",
            "type": "temp"
        }]
    }
}
```

### 前端显示

ComfyUI自动处理：
- 识别"images"格式
- 在节点上显示图片
- 提供右键菜单（保存、复制等）

## 📝 与旧版本的区别

### 旧版本（已废弃）
- ❌ 表格显示在页面右下角
- ❌ 需要JavaScript扩展
- ❌ 弹窗方式
- ❌ 不直观

### 新版本（当前）
- ✅ 表格显示在PreviewTable节点上
- ✅ 不需要前端扩展
- ✅ 图片方式
- ✅ 直观易用

## 🎯 适用场景

### ✅ 适合

- 快速查看数据结构
- 验证数据加载
- 展示数据样本
- 工作流调试

### ⚠️ 限制

- 只显示前20行（性能考虑）
- 图片格式（不可交互）
- 固定样式（不可自定义）

### 💡 如果需要完整数据

可以：
1. 增加`max_rows`参数
2. 或使用原始CSV文件
3. 或导出到Excel

## 🐛 故障排除

### Q: 节点上没有显示图片？

**检查后端日志**：
```
[OK] Saved table image: table_2_xxx.png
```

如果没有这行，说明图片生成失败。

**可能原因**：
- matplotlib未安装
- 数据格式错误
- 权限问题（无法写入temp目录）

### Q: 图片太小/太大？

调整代码中的`figsize`：
```python
fig, ax = plt.subplots(figsize=(12, 10))  # 调整这里
```

### Q: 想要更多行？

- 默认显示20行是为了性能
- 可以修改代码中的`display_rows`
- 但不建议超过50行（图片会很大）

### Q: 图片质量不好？

调整DPI：
```python
plt.savefig(path, dpi=150)  # 增加DPI
```

## 📚 相关文件

- `table_nodes.py` - PreviewTable节点实现
- `examples/sample_data.csv` - 示例数据
- `temp/` - 图片保存目录
- `README.md` - 主文档

## ✨ 总结

**PreviewTable现在的工作方式：**

1. 接收表格数据
2. 生成漂亮的表格图片
3. **图片显示在节点上**
4. 就像PreviewImage一样简单！

**这正是你想要的效果！** 🎉

---

**立即测试**：
```bash
python full_server.py
# 创建: LoadCSV → PreviewTable
# 查看PreviewTable节点，表格会在那里显示！
```

