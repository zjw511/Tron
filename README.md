# ComfyUI ç®€åŒ–ç‰ˆ

> å®Œæ•´åŠŸèƒ½çš„ComfyUIæœåŠ¡å™¨ - ä½¿ç”¨å®˜æ–¹å‰ç«¯ + æ¨¡å—åŒ–èŠ‚ç‚¹ç³»ç»Ÿ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# Windows
åŒå‡» START_FULL.bat

# æˆ–å‘½ä»¤è¡Œ
python full_server.py
```

### æ–¹æ³•2ï¼šè®¿é—®åœ°å€

æµè§ˆå™¨æ‰“å¼€ï¼š`http://127.0.0.1:8188`

## ğŸ“¦ å®‰è£…ä¾èµ–

é¦–æ¬¡ä½¿ç”¨éœ€è¦å®‰è£…ä¾èµ–ï¼š

```bash
pip install -r requirements.txt
```

ä¸»è¦ä¾èµ–ï¼š
- `aiohttp` - å¼‚æ­¥WebæœåŠ¡å™¨
- `Pillow` - å›¾ç‰‡å¤„ç†
- `comfyui-frontend-package` - ComfyUIå®˜æ–¹å‰ç«¯ç•Œé¢

## ğŸ“ é¡¹ç›®ç»“æ„

```
simple_comfyui/
â”œâ”€â”€ full_server.py          # å®Œæ•´åŠŸèƒ½æœåŠ¡å™¨ï¼ˆæ¨èä½¿ç”¨ï¼‰â­
â”œâ”€â”€ nodes.py                # èŠ‚ç‚¹å®šä¹‰ç³»ç»Ÿ
â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–åˆ—è¡¨
â”œâ”€â”€ START_FULL.bat          # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ simple_server.py        # ç®€åŒ–ç‰ˆæœåŠ¡å™¨ï¼ˆå¤‡ç”¨ï¼‰
â”œâ”€â”€ modular_server.py       # æ¨¡å—åŒ–æœåŠ¡å™¨ï¼ˆå¤‡ç”¨ï¼‰
â”œâ”€â”€ start_modular.bat       # æ¨¡å—åŒ–å¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ README.md               # æœ¬æ–‡ä»¶
â”œâ”€â”€ ä½¿ç”¨æŒ‡å—.md             # è¯¦ç»†ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ é¡¹ç›®è¯´æ˜.md             # é¡¹ç›®æ€»è§ˆ
â”œâ”€â”€ FULL_FEATURES.md        # å®Œæ•´åŠŸèƒ½æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰
â”‚
â”œâ”€â”€ input/                  # è¾“å…¥å›¾ç‰‡ç›®å½•
â”œâ”€â”€ output/                 # è¾“å‡ºç»“æœç›®å½•
â””â”€â”€ temp/                   # ä¸´æ—¶é¢„è§ˆç›®å½•
```

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### âœ… å®Œæ•´çš„èŠ‚ç‚¹ç³»ç»Ÿ

æ”¯æŒ12ç§èŠ‚ç‚¹ç±»å‹ï¼š

| èŠ‚ç‚¹ç±»å‹ | åŠŸèƒ½è¯´æ˜ |
|---------|---------|
| `LoadImage` | åŠ è½½å›¾ç‰‡ |
| `SaveImage` | ä¿å­˜å›¾ç‰‡ |
| `ImageScale` | å›¾ç‰‡ç¼©æ”¾ |
| `PreviewImage` | å®æ—¶é¢„è§ˆå›¾ç‰‡ |
| `PrimitiveFloat` | æµ®ç‚¹æ•°è¾“å…¥ |
| `PrimitiveString` | å­—ç¬¦ä¸²è¾“å…¥ |
| `LatentBlend` | æ½œåœ¨ç©ºé—´æ··åˆ |
| `VAEDecode` | VAEè§£ç  |
| `PreviewAny` | é¢„è§ˆä»»æ„ç±»å‹ |
| `Reroute` | é‡è·¯ç”±è¿æ¥ |
| `Note` | æ·»åŠ æ³¨é‡Š |
| `MarkdownNote` | Markdownæ³¨é‡Š |

### âœ… å·¥ä½œæµæ‰§è¡Œå¼•æ“

- **æ‹“æ‰‘æ’åº** - è‡ªåŠ¨æŒ‰ä¾èµ–å…³ç³»æ’åºèŠ‚ç‚¹
- **æ™ºèƒ½æ•°æ®ä¼ é€’** - è‡ªåŠ¨åŒ¹é…è¾“å…¥è¾“å‡ºç±»å‹
- **é”™è¯¯å¤„ç†** - å®Œæ•´çš„å¼‚å¸¸æ•è·å’ŒæŠ¥å‘Š
- **å¾ªç¯ä¾èµ–æ£€æµ‹** - é˜²æ­¢æ— é™å¾ªç¯

### âœ… WebSocketå®æ—¶é€šä¿¡

- å®æ—¶è¿æ¥ç®¡ç†
- å¹¿æ’­æ¶ˆæ¯ç³»ç»Ÿ
- `executed` äº‹ä»¶æ¨é€
- å›¾ç‰‡é¢„è§ˆå®æ—¶æ˜¾ç¤º

### âœ… å®Œæ•´çš„APIæ”¯æŒ

23ä¸ªå®Œæ•´çš„APIç«¯ç‚¹ï¼Œå…¼å®¹ComfyUIæ ‡å‡†ï¼š

**æ ¸å¿ƒAPI:**
- `POST /prompt` - æ‰§è¡Œå·¥ä½œæµ
- `GET /object_info` - è·å–èŠ‚ç‚¹ä¿¡æ¯
- `GET /queue` - é˜Ÿåˆ—çŠ¶æ€
- `GET /history` - å†å²è®°å½•
- `GET /system_stats` - ç³»ç»ŸçŠ¶æ€
- `GET /ws` - WebSocketè¿æ¥

**ç”¨æˆ·API:**
- `GET/POST /users` - ç”¨æˆ·ç®¡ç†
- `GET/POST /settings` - è®¾ç½®ç®¡ç†
- `GET /userdata` - ç”¨æˆ·æ•°æ®

**å›¾ç‰‡API:**
- `GET /view` - æŸ¥çœ‹å›¾ç‰‡

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå›¾ç‰‡é¢„è§ˆ

```
1. æ·»åŠ  LoadImage èŠ‚ç‚¹
2. æ·»åŠ  PreviewImage èŠ‚ç‚¹
3. è¿æ¥ï¼šLoadImage â†’ PreviewImage
4. ç‚¹å‡» "Queue Prompt" è¿è¡Œ
5. å›¾ç‰‡ä¼šå®æ—¶æ˜¾ç¤ºåœ¨PreviewImageèŠ‚ç‚¹ä¸­
```

### ç¤ºä¾‹2ï¼šå›¾ç‰‡ç¼©æ”¾ä¿å­˜

```
1. æ·»åŠ  LoadImage èŠ‚ç‚¹
2. æ·»åŠ  ImageScale èŠ‚ç‚¹ï¼ˆè®¾ç½®å®½é«˜512x512ï¼‰
3. æ·»åŠ  SaveImage èŠ‚ç‚¹
4. è¿æ¥ï¼šLoadImage â†’ ImageScale â†’ SaveImage
5. è¿è¡ŒåæŸ¥çœ‹ output/ ç›®å½•
```

### ç¤ºä¾‹3ï¼šå¤šè¾“å‡ºå·¥ä½œæµ

```
LoadImage â†’ ImageScale â†’ PreviewImage
          â†“
       SaveImage
```

## ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | full_server.py | simple_server.py | modular_server.py |
|------|---------------|------------------|-------------------|
| èŠ‚ç‚¹ç³»ç»Ÿ | âœ… æ¨¡å—åŒ–ï¼ˆnodes.pyï¼‰ | âš ï¸ ç¡¬ç¼–ç  | âœ… æ¨¡å—åŒ– |
| æ‰§è¡Œå¼•æ“ | âœ… å®Œæ•´æ‹“æ‰‘æ’åº | âš ï¸ ç®€åŒ–ç‰ˆ | âœ… å®Œæ•´ |
| WebSocket | âœ… å®Œæ•´å¹¿æ’­ç³»ç»Ÿ | âš ï¸ åŸºç¡€ | âœ… å®Œæ•´ |
| å›¾ç‰‡é¢„è§ˆ | âœ… å®æ—¶é¢„è§ˆ | âŒ æ—  | âœ… å®æ—¶é¢„è§ˆ |
| é”™è¯¯å¤„ç† | âœ… å®Œæ•´è¿½è¸ª | âš ï¸ åŸºç¡€ | âœ… å®Œæ•´ |
| å†å²è®°å½• | âœ… æœ‰ | âŒ æ—  | âœ… æœ‰ |
| è°ƒè¯•æ—¥å¿— | âœ… è¯¦ç»† | âš ï¸ å°‘ | âœ… è¯¦ç»† |
| APIç«¯ç‚¹ | âœ… 23ä¸ª | âš ï¸ 15ä¸ª | âœ… 23ä¸ª |
| **æ¨èç”¨é€”** | **ç”Ÿäº§ä½¿ç”¨** | å­¦ä¹ ç†è§£ | å¼€å‘è°ƒè¯• |

## ğŸ› å¸¸è§é—®é¢˜

### Q: ç«¯å£8188è¢«å ç”¨ï¼Ÿ

```bash
# Windows PowerShell
Get-Process python | Stop-Process -Force
```

### Q: é¡µé¢ç©ºç™½æˆ–404é”™è¯¯ï¼Ÿ

1. ç¡®è®¤å·²å®‰è£… `comfyui-frontend-package`
2. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ï¼š`Ctrl+Shift+R`
3. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—

### Q: å›¾ç‰‡ä¸æ˜¾ç¤ºï¼Ÿ

1. æ£€æŸ¥ `input/` ç›®å½•æ˜¯å¦æœ‰å›¾ç‰‡
2. æŸ¥çœ‹æµè§ˆå™¨Consoleé”™è¯¯ï¼ˆF12ï¼‰
3. æŸ¥çœ‹æœåŠ¡å™¨æ§åˆ¶å°æ—¥å¿—

### Q: èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥ï¼Ÿ

æŸ¥çœ‹æœåŠ¡å™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š
- `[>>]` - ä¿¡æ¯æ—¥å¿—
- `[*]` - æ‰§è¡Œæ—¥å¿—
- `[OK]` - æˆåŠŸæ—¥å¿—
- `[X]` - é”™è¯¯æ—¥å¿—

## ğŸ”§ å¼€å‘è¯´æ˜

### æ·»åŠ è‡ªå®šä¹‰èŠ‚ç‚¹

åœ¨ `nodes.py` ä¸­ï¼š

```python
class MyCustomNode(NodeBase):
    def __init__(self):
        super().__init__()
        self.name = "MyCustomNode"
        self.category = "custom"
        
    def get_node_info(self):
        return {
            "input": {"required": {"input": ["STRING", {}]}},
            "output": ["STRING"],
            # ...
        }
    
    def execute(self, inputs, node_id):
        # ä½ çš„é€»è¾‘
        return {"STRING": result}
```

èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°ç³»ç»Ÿï¼

### ä¿®æ”¹ç«¯å£

åœ¨ `full_server.py` ä¸­ä¿®æ”¹ï¼š

```python
site = web.TCPSite(runner, '127.0.0.1', 8188)
#                                        ^^^^
#                                        æ”¹è¿™é‡Œ
```

## ğŸ“– æ–‡æ¡£

- **README.md** - æœ¬æ–‡ä»¶ï¼ˆå¿«é€Ÿå¼€å§‹ï¼‰
- **ä½¿ç”¨æŒ‡å—.md** - è¯¦ç»†ä½¿ç”¨è¯´æ˜
- **é¡¹ç›®è¯´æ˜.md** - é¡¹ç›®ç»“æ„å’ŒçŠ¶æ€
- **FULL_FEATURES.md** - å®Œæ•´åŠŸèƒ½æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦åˆ é™¤æ ¸å¿ƒæ–‡ä»¶**ï¼š
   - `full_server.py`
   - `nodes.py`
   - `requirements.txt`

2. é¦–æ¬¡è¿è¡Œéœ€è¦å®‰è£…ä¾èµ–

3. ç¡®ä¿ç«¯å£8188æœªè¢«å ç”¨

4. `input/` ç›®å½•éœ€è¦æœ‰æµ‹è¯•å›¾ç‰‡

5. ä½¿ç”¨ `Ctrl+C` æ­£å¸¸åœæ­¢æœåŠ¡å™¨

## ğŸ¯ æŠ€æœ¯æ ˆ

**åç«¯ï¼š**
- Python 3.11+
- aiohttp (å¼‚æ­¥WebæœåŠ¡å™¨)
- Pillow (å›¾ç‰‡å¤„ç†)

**å‰ç«¯ï¼š**
- comfyui_frontend_package (å®˜æ–¹å‰ç«¯)
- LiteGraph.js (èŠ‚ç‚¹ç¼–è¾‘å™¨)
- WebSocket (å®æ—¶é€šä¿¡)

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-10-26)

- âœ… å®Œæ•´çš„èŠ‚ç‚¹ç³»ç»Ÿï¼ˆ12ç§èŠ‚ç‚¹ï¼‰
- âœ… æ‹“æ‰‘æ’åºæ‰§è¡Œå¼•æ“
- âœ… WebSocketå®æ—¶é€šä¿¡
- âœ… å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
- âœ… 23ä¸ªå®Œæ•´APIç«¯ç‚¹
- âœ… ä¸­æ–‡ç•Œé¢æ”¯æŒ
- âœ… è¯¦ç»†æ–‡æ¡£

## ğŸ“ æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹ [ä½¿ç”¨æŒ‡å—.md](ä½¿ç”¨æŒ‡å—.md)
2. æŸ¥çœ‹ [FULL_FEATURES.md](FULL_FEATURES.md)
3. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
4. æ£€æŸ¥æµè§ˆå™¨Consoleï¼ˆF12ï¼‰

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

