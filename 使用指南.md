# ComfyUI ç®€åŒ–ç‰ˆ - ä½¿ç”¨æŒ‡å—

> è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œæ“ä½œæŒ‡å—

## ğŸ“ æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰

| æ–‡ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| `full_server.py` | 21.1 KB | â­ å®Œæ•´åŠŸèƒ½æœåŠ¡å™¨ï¼ˆæ¨èä½¿ç”¨ï¼‰ |
| `nodes.py` | 11.9 KB | èŠ‚ç‚¹å®šä¹‰ç³»ç»Ÿ |
| `requirements.txt` | 0.3 KB | Pythonä¾èµ–åŒ…åˆ—è¡¨ |
| `START_FULL.bat` | 0.3 KB | å¿«é€Ÿå¯åŠ¨è„šæœ¬ |

### å¤‡ç”¨æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

| æ–‡ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| `simple_server.py` | 22.1 KB | ç®€åŒ–ç‰ˆæœåŠ¡å™¨ |
| `modular_server.py` | 20.3 KB | æ¨¡å—åŒ–æœåŠ¡å™¨ |
| `start_modular.bat` | 0.3 KB | æ¨¡å—åŒ–æœåŠ¡å™¨å¯åŠ¨è„šæœ¬ |

### æ–‡æ¡£æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `README.md` | å¿«é€Ÿå¼€å§‹æŒ‡å— |
| `ä½¿ç”¨æŒ‡å—.md` | æœ¬æ–‡ä»¶ - è¯¦ç»†ä½¿ç”¨è¯´æ˜ |
| `é¡¹ç›®è¯´æ˜.md` | é¡¹ç›®ç»“æ„å’ŒçŠ¶æ€ |
| `FULL_FEATURES.md` | å®Œæ•´åŠŸèƒ½æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰ |

### è‡ªåŠ¨åˆ›å»ºçš„ç›®å½•

| ç›®å½• | ç”¨é€” |
|------|------|
| `input/` | è¾“å…¥å›¾ç‰‡ç›®å½• |
| `output/` | è¾“å‡ºç»“æœç›®å½• |
| `temp/` | ä¸´æ—¶é¢„è§ˆå›¾ç‰‡ç›®å½• |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1ï¼šåŒå‡»å¯åŠ¨ï¼ˆæ¨èï¼‰

```
åŒå‡» START_FULL.bat
```

### æ–¹æ³•2ï¼šå‘½ä»¤è¡Œå¯åŠ¨

```bash
python full_server.py
```

### è®¿é—®åœ°å€

```
http://127.0.0.1:8188
```

## ğŸ“¦ å®‰è£…ä¾èµ–

### é¦–æ¬¡ä½¿ç”¨

```bash
pip install -r requirements.txt
```

### ä¸»è¦ä¾èµ–

```
aiohttp          # WebæœåŠ¡å™¨
Pillow           # å›¾ç‰‡å¤„ç†
comfyui-frontend-package  # å®˜æ–¹å‰ç«¯ç•Œé¢
```

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### âœ… å®Œæ•´çš„èŠ‚ç‚¹ç³»ç»Ÿ

#### å›¾ç‰‡å¤„ç†èŠ‚ç‚¹

| èŠ‚ç‚¹ | åŠŸèƒ½ | è¾“å…¥ | è¾“å‡º |
|------|------|------|------|
| `LoadImage` | åŠ è½½å›¾ç‰‡ | å›¾ç‰‡è·¯å¾„ | IMAGE |
| `SaveImage` | ä¿å­˜å›¾ç‰‡ | IMAGE | - |
| `ImageScale` | å›¾ç‰‡ç¼©æ”¾ | IMAGE, å®½, é«˜ | IMAGE |
| `PreviewImage` | é¢„è§ˆå›¾ç‰‡ | IMAGE | - |

#### åŸºç¡€ç±»å‹èŠ‚ç‚¹

| èŠ‚ç‚¹ | åŠŸèƒ½ | è¾“å‡º |
|------|------|------|
| `PrimitiveFloat` | æµ®ç‚¹æ•° | FLOAT |
| `PrimitiveString` | å­—ç¬¦ä¸² | STRING |

#### é«˜çº§èŠ‚ç‚¹

| èŠ‚ç‚¹ | åŠŸèƒ½ |
|------|------|
| `LatentBlend` | æ½œåœ¨ç©ºé—´æ··åˆ |
| `VAEDecode` | VAEè§£ç  |
| `PreviewAny` | é¢„è§ˆä»»æ„ç±»å‹ |
| `Reroute` | é‡è·¯ç”±è¿æ¥ |
| `Note` | æ·»åŠ æ³¨é‡Š |
| `MarkdownNote` | Markdownæ³¨é‡Š |

### âœ… å·¥ä½œæµæ‰§è¡Œå¼•æ“

- **æ‹“æ‰‘æ’åº** - è‡ªåŠ¨æŒ‰ä¾èµ–å…³ç³»æ’åºèŠ‚ç‚¹
- **æ™ºèƒ½æ•°æ®ä¼ é€’** - è‡ªåŠ¨åŒ¹é…è¾“å…¥è¾“å‡ºç±»å‹
- **é”™è¯¯å¤„ç†** - æ•è·å¹¶æŠ¥å‘ŠèŠ‚ç‚¹æ‰§è¡Œé”™è¯¯
- **å¾ªç¯ä¾èµ–æ£€æµ‹** - é˜²æ­¢æ— é™å¾ªç¯
- **ä¿ç•™åŸå§‹å¯¹è±¡** - PIL Imageç­‰å¯¹è±¡åœ¨èŠ‚ç‚¹é—´ç›´æ¥ä¼ é€’

### âœ… WebSocketå®æ—¶é€šä¿¡

- **å®æ—¶è¿æ¥ç®¡ç†** - è‡ªåŠ¨ç®¡ç†å®¢æˆ·ç«¯è¿æ¥
- **å¹¿æ’­æ¶ˆæ¯** - åŒæ—¶æ¨é€ç»™æ‰€æœ‰å®¢æˆ·ç«¯
- **executedäº‹ä»¶** - èŠ‚ç‚¹æ‰§è¡Œå®Œæˆé€šçŸ¥
- **å›¾ç‰‡é¢„è§ˆ** - å®æ—¶æ˜¾ç¤ºPreviewImageç»“æœ

### âœ… å›¾ç‰‡å¤„ç†ç³»ç»Ÿ

- **`/view` API** - æŸ¥çœ‹å›¾ç‰‡
- **ä¸‰ä¸ªç›®å½•æ”¯æŒ** - `output/`, `input/`, `temp/`
- **å­æ–‡ä»¶å¤¹æ”¯æŒ** - æ”¯æŒå¤šçº§ç›®å½•
- **å®‰å…¨è·¯å¾„æ£€æŸ¥** - é˜²æ­¢ç›®å½•éå†æ”»å‡»
- **PreviewImageè‡ªåŠ¨ä¿å­˜** - è‡ªåŠ¨ä¿å­˜åˆ°tempç›®å½•

### âœ… å®Œæ•´çš„APIç«¯ç‚¹

#### æ ¸å¿ƒAPI

```
POST /prompt              - æ‰§è¡Œå·¥ä½œæµ
GET  /object_info         - è·å–æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯
GET  /queue               - é˜Ÿåˆ—çŠ¶æ€
GET  /history             - å†å²è®°å½•
GET  /history/{prompt_id} - ç‰¹å®šå†å²
GET  /embeddings          - åµŒå…¥åˆ—è¡¨
GET  /extensions          - æ‰©å±•åˆ—è¡¨
GET  /system_stats        - ç³»ç»ŸçŠ¶æ€
GET  /ws                  - WebSocketè¿æ¥
```

#### ç”¨æˆ·API

```
GET/POST /users           - ç”¨æˆ·ç®¡ç†
GET/POST /user_config     - ç”¨æˆ·é…ç½®
GET/POST /settings        - è®¾ç½®
GET/POST /settings/{key}  - ç‰¹å®šè®¾ç½®
GET      /userdata        - ç”¨æˆ·æ•°æ®
```

#### å…¶ä»–API

```
GET /api/i18n             - å›½é™…åŒ–ï¼ˆä¸­æ–‡æ”¯æŒï¼‰
GET /api/experiment/models - å®éªŒæ¨¡å‹
GET /api/workflows        - å·¥ä½œæµåˆ—è¡¨
GET /api/entities         - å®ä½“åˆ—è¡¨
GET /manifest.json        - PWAæ¸…å•
GET /user.css             - ç”¨æˆ·CSS
GET /view                 - æŸ¥çœ‹å›¾ç‰‡
```

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå›¾ç‰‡é¢„è§ˆ

**æ­¥éª¤ï¼š**

1. æ·»åŠ  `LoadImage` èŠ‚ç‚¹
2. æ·»åŠ  `PreviewImage` èŠ‚ç‚¹
3. è¿æ¥ï¼š`LoadImage` â†’ `PreviewImage`
4. ç‚¹å‡» "Queue Prompt" è¿è¡Œ
5. å›¾ç‰‡ä¼šå®æ—¶æ˜¾ç¤ºåœ¨PreviewImageèŠ‚ç‚¹ä¸­

**å·¥ä½œæµï¼š**

```
LoadImage â†’ PreviewImage
```

**è¯´æ˜ï¼š**
- LoadImageä»`input/`ç›®å½•åŠ è½½å›¾ç‰‡
- PreviewImageé€šè¿‡WebSocketå®æ—¶æ˜¾ç¤º
- å›¾ç‰‡ä¿å­˜åœ¨`temp/`ç›®å½•

### ç¤ºä¾‹2ï¼šå›¾ç‰‡ç¼©æ”¾ä¿å­˜

**æ­¥éª¤ï¼š**

1. æ·»åŠ  `LoadImage` èŠ‚ç‚¹
2. æ·»åŠ  `ImageScale` èŠ‚ç‚¹
   - è®¾ç½®å®½åº¦ï¼š512
   - è®¾ç½®é«˜åº¦ï¼š512
3. æ·»åŠ  `SaveImage` èŠ‚ç‚¹
4. è¿æ¥ï¼š`LoadImage` â†’ `ImageScale` â†’ `SaveImage`
5. è¿è¡ŒåæŸ¥çœ‹ `output/` ç›®å½•

**å·¥ä½œæµï¼š**

```
LoadImage â†’ ImageScale â†’ SaveImage
```

**è¯´æ˜ï¼š**
- ImageScaleè°ƒæ•´å›¾ç‰‡å¤§å°
- SaveImageä¿å­˜åˆ°`output/`ç›®å½•
- æ–‡ä»¶åæ ¼å¼ï¼š`ComfyUI_00001_.png`

### ç¤ºä¾‹3ï¼šå¤šè¾“å‡ºå·¥ä½œæµ

**å·¥ä½œæµï¼š**

```
LoadImage â†’ ImageScale â†’ PreviewImage
          â†“
       SaveImage
```

**è¯´æ˜ï¼š**
- ImageScaleçš„è¾“å‡ºåŒæ—¶è¿æ¥åˆ°ä¸¤ä¸ªèŠ‚ç‚¹
- PreviewImageå®æ—¶é¢„è§ˆ
- SaveImageä¿å­˜ç»“æœ

### ç¤ºä¾‹4ï¼šä½¿ç”¨åŸºç¡€ç±»å‹

**å·¥ä½œæµï¼š**

```
PrimitiveFloat â†’ ImageScale (width)
PrimitiveFloat â†’ ImageScale (height)
LoadImage â†’ ImageScale â†’ SaveImage
```

**è¯´æ˜ï¼š**
- ä½¿ç”¨PrimitiveFloatèŠ‚ç‚¹æä¾›å®½é«˜å‚æ•°
- å¯ä»¥åŠ¨æ€è°ƒæ•´å‚æ•°

## ğŸ“‚ ç›®å½•è¯´æ˜

### input/ ç›®å½•

**ç”¨é€”ï¼š** æ”¾ç½®è¾“å…¥å›¾ç‰‡

**æ”¯æŒæ ¼å¼ï¼š**
- PNG
- JPG / JPEG
- BMP
- GIF

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. å°†å›¾ç‰‡å¤åˆ¶åˆ°`input/`ç›®å½•
2. åœ¨LoadImageèŠ‚ç‚¹ä¸­é€‰æ‹©å›¾ç‰‡

### output/ ç›®å½•

**ç”¨é€”ï¼š** ä¿å­˜è¾“å‡ºç»“æœ

**æ–‡ä»¶å‘½åï¼š**
- æ ¼å¼ï¼š`{prefix}_{counter}_.png`
- ç¤ºä¾‹ï¼š`ComfyUI_00001_.png`

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. SaveImageèŠ‚ç‚¹è‡ªåŠ¨ä¿å­˜
2. å¯ä»¥è®¾ç½®filename_prefixå‚æ•°

### temp/ ç›®å½•

**ç”¨é€”ï¼š** ä¸´æ—¶é¢„è§ˆå›¾ç‰‡

**ç‰¹ç‚¹ï¼š**
- PreviewImageèŠ‚ç‚¹è‡ªåŠ¨ä¿å­˜
- ç”¨äºWebSocketå®æ—¶æ˜¾ç¤º
- æ–‡ä»¶ååŒ…å«éšæœºå­—ç¬¦ä¸²

**æ¸…ç†ï¼š**
- å¯ä»¥å®šæœŸæ‰‹åŠ¨æ¸…ç†
- ä¸å½±å“å·¥ä½œæµæ‰§è¡Œ

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ç«¯å£8188è¢«å ç”¨ï¼Ÿ

**é—®é¢˜ï¼š**
```
OSError: [Errno 10048] error while attempting to bind on address
```

**è§£å†³æ–¹æ³•ï¼š**

```powershell
# Windows PowerShell
Get-Process python | Stop-Process -Force
```

æˆ–è€…ä¿®æ”¹ç«¯å£ï¼š

```python
# åœ¨ full_server.py ä¸­
site = web.TCPSite(runner, '127.0.0.1', 8188)
#                                        ^^^^
#                                        æ”¹æˆå…¶ä»–ç«¯å£
```

### Q2: é¡µé¢ç©ºç™½æˆ–404é”™è¯¯ï¼Ÿ

**å¯èƒ½åŸå› ï¼š**
1. å‰ç«¯åŒ…æœªå®‰è£…
2. æµè§ˆå™¨ç¼“å­˜
3. è·¯ç”±é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**

```bash
# 1. ç¡®è®¤å‰ç«¯åŒ…å·²å®‰è£…
pip install comfyui-frontend-package

# 2. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨
æŒ‰ Ctrl+Shift+R

# 3. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
```

### Q3: å›¾ç‰‡ä¸æ˜¾ç¤ºï¼Ÿ

**æ£€æŸ¥æ¸…å•ï¼š**

1. **input/ç›®å½•æ˜¯å¦æœ‰å›¾ç‰‡ï¼Ÿ**
   ```bash
   ls input/
   ```

2. **æµè§ˆå™¨Consoleæœ‰é”™è¯¯ï¼Ÿ**
   - æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
   - æŸ¥çœ‹Consoleæ ‡ç­¾

3. **æœåŠ¡å™¨æ—¥å¿—æœ‰é”™è¯¯ï¼Ÿ**
   - æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
   - æŸ¥æ‰¾`[X]`æ ‡è®°çš„é”™è¯¯

4. **å›¾ç‰‡è·¯å¾„æ­£ç¡®ï¼Ÿ**
   - LoadImageèŠ‚ç‚¹çš„è·¯å¾„
   - ç›¸å¯¹äºinput/ç›®å½•

### Q4: èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥ï¼Ÿ

**æŸ¥çœ‹æ—¥å¿—ï¼š**

æœåŠ¡å™¨æ§åˆ¶å°ä¼šæ˜¾ç¤ºï¼š
```
[>>] ä¿¡æ¯æ—¥å¿—
[*]  æ‰§è¡Œæ—¥å¿—
[OK] æˆåŠŸæ—¥å¿—
[X]  é”™è¯¯æ—¥å¿—
```

**å¸¸è§é”™è¯¯ï¼š**

1. **å›¾ç‰‡æœªæ‰¾åˆ°**
   ```
   [X] Not found: input/test.png
   ```
   è§£å†³ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨

2. **èŠ‚ç‚¹ç±»å‹æœªçŸ¥**
   ```
   [X] Unknown node type: XXX
   ```
   è§£å†³ï¼šæ£€æŸ¥èŠ‚ç‚¹åç§°æ‹¼å†™

3. **è¾“å…¥æ•°æ®é”™è¯¯**
   ```
   [X] Cannot find valid PIL Image object
   ```
   è§£å†³ï¼šæ£€æŸ¥èŠ‚ç‚¹è¿æ¥æ˜¯å¦æ­£ç¡®

### Q5: WebSocketè¿æ¥å¤±è´¥ï¼Ÿ

**æ£€æŸ¥ï¼š**

1. æµè§ˆå™¨Networkæ ‡ç­¾
   - ç­›é€‰WS
   - æŸ¥çœ‹è¿æ¥çŠ¶æ€

2. æœåŠ¡å™¨æ—¥å¿—
   ```
   [>>] WebSocket client connected
   ```

3. é˜²ç«å¢™è®¾ç½®
   - å…è®¸8188ç«¯å£

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

**æ—¥å¿—æ ¼å¼ï¼š**

```
[>>] ä¿¡æ¯æ—¥å¿— - ä¸€èˆ¬ä¿¡æ¯
[*]  æ‰§è¡Œæ—¥å¿— - èŠ‚ç‚¹æ‰§è¡Œ
[OK] æˆåŠŸæ—¥å¿— - æ“ä½œæˆåŠŸ
[X]  é”™è¯¯æ—¥å¿— - é”™è¯¯ä¿¡æ¯
```

**ç¤ºä¾‹ï¼š**

```
[>>] Received workflow request
[*] Executing node 1: LoadImage
    [OK] Loaded: input/test.png (1024x768)
[*] Executing node 2: PreviewImage
    [OK] Preview saved: temp/ComfyUI_temp_abc12_00001_.png
[OK] Workflow completed!
```

### 2. æŸ¥çœ‹æµè§ˆå™¨Console

**æ‰“å¼€æ–¹å¼ï¼š**
- æŒ‰ `F12`
- æˆ–å³é”® â†’ æ£€æŸ¥

**æŸ¥çœ‹å†…å®¹ï¼š**
- JavaScripté”™è¯¯
- APIè¯·æ±‚
- WebSocketæ¶ˆæ¯

### 3. æŸ¥çœ‹Networkè¯·æ±‚

**å¼€å‘è€…å·¥å…· â†’ Networkæ ‡ç­¾**

**ç­›é€‰ï¼š**
- `XHR` - APIè¯·æ±‚
- `WS` - WebSocketè¿æ¥
- `Img` - å›¾ç‰‡åŠ è½½

**æŸ¥çœ‹ï¼š**
- è¯·æ±‚URL
- å“åº”çŠ¶æ€ç 
- å“åº”å†…å®¹

### 4. æµ‹è¯•API

**ä½¿ç”¨curlï¼š**

```bash
# æµ‹è¯•èŠ‚ç‚¹ä¿¡æ¯
curl http://127.0.0.1:8188/object_info

# æµ‹è¯•ç³»ç»ŸçŠ¶æ€
curl http://127.0.0.1:8188/system_stats

# æµ‹è¯•é˜Ÿåˆ—
curl http://127.0.0.1:8188/queue
```

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ è‡ªå®šä¹‰èŠ‚ç‚¹

**æ­¥éª¤ï¼š**

1. åœ¨`nodes.py`ä¸­åˆ›å»ºæ–°ç±»ï¼š

```python
class MyCustomNode(NodeBase):
    def __init__(self):
        super().__init__()
        self.name = "MyCustomNode"
        self.category = "custom"
        self.icon = "ğŸ¨"
        self.inputs = ["STRING"]
        self.outputs = ["STRING"]
        self.description = "My custom node"
    
    def get_node_info(self):
        return {
            "input": {
                "required": {
                    "text": ["STRING", {"default": ""}]
                }
            },
            "output": ["STRING"],
            "output_is_list": [False],
            "output_name": ["STRING"],
            "name": "MyCustomNode",
            "display_name": "My Custom Node",
            "description": "My custom node",
            "category": "custom",
            "output_node": False
        }
    
    def execute(self, inputs, node_id):
        text = inputs.get("text", "")
        result = text.upper()  # ä½ çš„é€»è¾‘
        return {"STRING": result}
```

2. èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°ç³»ç»Ÿ

3. é‡å¯æœåŠ¡å™¨

4. åœ¨å‰ç«¯æ·»åŠ èŠ‚ç‚¹

### ä¿®æ”¹ç«¯å£

**åœ¨`full_server.py`ä¸­ï¼š**

```python
site = web.TCPSite(runner, '127.0.0.1', 8188)
#                                        ^^^^
#                                        æ”¹æˆå…¶ä»–ç«¯å£
```

### ä¿®æ”¹ç›®å½•

**åœ¨`full_server.py`ä¸­ï¼š**

```python
INPUT_DIR = Path("input")
OUTPUT_DIR = Path("output")
TEMP_DIR = Path("temp")
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä¸è¦åˆ é™¤

- `full_server.py` - æ ¸å¿ƒæœåŠ¡å™¨
- `nodes.py` - èŠ‚ç‚¹ç³»ç»Ÿ
- `requirements.txt` - ä¾èµ–åˆ—è¡¨

### ä½¿ç”¨å»ºè®®

1. é¦–æ¬¡è¿è¡Œéœ€è¦å®‰è£…ä¾èµ–
2. ç¡®ä¿ç«¯å£8188æœªè¢«å ç”¨
3. `input/`ç›®å½•éœ€è¦æœ‰æµ‹è¯•å›¾ç‰‡
4. ä½¿ç”¨`Ctrl+C`æ­£å¸¸åœæ­¢æœåŠ¡å™¨
5. å®šæœŸæ¸…ç†`temp/`ç›®å½•

### æ€§èƒ½å»ºè®®

1. å›¾ç‰‡ä¸è¦å¤ªå¤§ï¼ˆå»ºè®®<4Kï¼‰
2. å·¥ä½œæµä¸è¦å¤ªå¤æ‚
3. å®šæœŸæ¸…ç†å†å²è®°å½•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **README.md** - å¿«é€Ÿå¼€å§‹
- **é¡¹ç›®è¯´æ˜.md** - é¡¹ç›®ç»“æ„
- **FULL_FEATURES.md** - å®Œæ•´åŠŸèƒ½æ–‡æ¡£

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

